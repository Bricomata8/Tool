Tracker.trackPageView();const storageController=new StorageController,urlObj=new URL(location.href),formElement=document.querySelector("#feedback-form"),headlineElement=document.querySelector("#headline"),senderElement=document.querySelector("#sender"),textElement=document.querySelector("#text"),successElement=document.querySelector("#success-message"),directMailElement=document.querySelector("#feedback-form-direct-email");translateSection(document.documentElement),urlObj.searchParams.get("title")&&(headlineElement.textContent=urlObj.searchParams.get("title"));const hostName=urlObj.searchParams.get("hostname"),manifest=browser.runtime.getManifest(),version=manifest&&manifest.version||"unknown",subject=`Feedback LanguageTool on ${hostName} (v${version}, lang: ${navigator.language}, browser: ${getBrowserName()})`,linkHtml=`<a href="mailto:feedback@languagetool.org?subject=${encodeURIComponent(subject)}">feedback@languagetool.org</a>`;directMailElement.innerHTML=browser.i18n.getMessage("feedbackDirectMail",[linkHtml]),formElement.addEventListener("submit",e=>{e.preventDefault();const t=senderElement.value;Tracker.trackEvent("Action","send_feedback",t),storageController.onReady(()=>{const{firstVisit:e,ratingValue:n,sessionCount:r}=storageController.getStatistics(),{hasPaidSubscription:a}=storageController.getUIState(),{geoIpLanguages:o}=storageController.getSettings(),s=urlObj.searchParams.get("hostname"),l=urlObj.searchParams.get("url");let c=`From: ${senderElement.value}\n`;c+=`Accept-Languages: ${navigator.languages.join(", ")}\n`,c+=`UI-Language: ${browser.i18n.getUILanguage()}\n`,c+=`GeoIP-Languages: ${o.join(", ")}\n`,c+=`Host: ${s}\n`,c+=`Full URL: ${l}\n`,c+=`Addon Version: ${browser.runtime.getManifest().version}\n`,c+=`Matomo: ${storageController.uniqueId}\n`,c+=`User Agent: ${navigator.userAgent}\n`,c+=`CPU Cores: ${navigator.hardwareConcurrency}\n`,c+=`User since: ${new Date(1e3*e).toUTCString()}\n`,c+=`Paying user: ${a}\n`,c+=`Do not track: ${navigator.doNotTrack}\n`,c+=`Rating: ${n}\n`,c+=`Sessions: ${r}\n`;const i=`${textElement.value}\n\n\n${c}`;storageController.updateSettings({knownEmail:t}),browser.runtime.sendMessage({command:"SEND_FEEDBACK",sender:senderElement.value,text:i}).then(()=>{formElement.style.display="none",successElement.style.display="block"}).catch(()=>{Tracker.trackError("message","error_send_feedback"),alert(browser.i18n.getMessage("feedbackError"))})})});