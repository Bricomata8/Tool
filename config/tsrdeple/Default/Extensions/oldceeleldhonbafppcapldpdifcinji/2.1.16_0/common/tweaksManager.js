/*! (C) Copyright 2018 LanguageTooler GmbH. All rights reserved. */
class TweaksManager{static _anonymizeEmail(e){return e.replace(TweaksManager.EMAIL_DOMAIN_REG_EXP,"@replaced.domain").trim()}static _removeEmail(e){return e.replace(TweaksManager.EMAIL_REG_EXP,"").trim()}static getTweaks(e){if(!e)return TweaksManager.DEFAULT_TWEAKS;let t=Object.assign({},TweaksManager.DEFAULT_TWEAKS);const a=getSubdomains(e);for(const e of a)t=Object.assign(t,TweaksManager.CUSTOM_TWEAKS[e]);return t}}TweaksManager.EMAIL_REG_EXP=/<?(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])>?/g,TweaksManager.EMAIL_DOMAIN_REG_EXP=/@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/g,TweaksManager.DEFAULT_TWEAKS={init(){document.documentElement.setAttribute("data-lt-installed","true")},supported:()=>!0,unsupportedMessage:()=>"",isElementCompatible(e){if(!(isInputArea(e)&&!e.readOnly))return!1;if(e.closest("quill-editor"))return!1;if(e.classList.contains("cke_editable"))return!0;if(e.ownerDocument.head&&isTinyMCE(e)){const t=document.createElement("script"),a="_isTinymceSpellcheckerActivated";return t.innerText=`\n                    try {\n                        if (window.parent.tinymce.get(document.body.dataset.id).plugins.tinymcespellchecker) {\n                            document.body.dataset.${a} = true;\n                        }\n                    } catch(e) {}\n                `,e.ownerDocument.head.appendChild(t),t.remove(),!Boolean(e.dataset[a])}return!!(window.innerHeight>=150&&window.innerWidth>=150)&&"false"!==e.getAttribute("spellcheck")},toolbarSettings(e){const t=[Dialog.CONTAINER_ELEMENT_NAME,ErrorCard.CONTAINER_ELEMENT_NAME].join(", ");return{isVisible(e,t){const a=!e.textContent.trim(),o=t.getPaddingBox(e);return!(a&&o.height<32)&&(o.width>=160&&o.height>=18)},getPosition(e,a,o){if(e===e.ownerDocument.body)return{fixed:!0,left:document.documentElement.clientWidth-a.width-6+"px"};const i=document.documentElement.clientHeight,n=getVisibleTopAndBottom(e,o,i,t),s=n.bottom-n.top;if(s<a.height)return null;const r=o.getPaddingBox(e);let l=r.top+n.bottom-6-a.height,c=r.right-6-a.width;if(s<=40){l=r.top+n.bottom-s/2-a.height/2}const g=r.height>=250,d=(document.documentElement.scrollTop||document.body.scrollTop)+i;if(g&&r.top+n.bottom>d&&r.top+a.height+12<d)return{fixed:!0,left:Math.round(c)+"px"};if(l>d)return null;const m=d-a.height-8;return l=Math.min(l,m),{fixed:!1,left:Math.round(c)+"px",top:Math.round(l)+"px"}}}},getParsingDetector(e){const t=!!location.href.match(/appsuite/),a=document.body&&document.body.dataset&&document.body.dataset.id&&document.body.dataset.id.includes("ZmHtmlEditor");let o=location.href.includes("/owa/")||!!document.querySelector(".owa-font-compose");try{o=o||window.parent.location.href.includes("/owa/")||!!window.parent.document.querySelector(".owa-font-compose")}catch(e){}let i=!1;try{i=!!window.parent.document.title.match(/roundcube/i)}catch(e){}let n=!1;try{n=window.parent.location.hostname.includes("mail.protonmail.com")}catch(e){}let s=!1;try{s=window.parent.location.href.includes("otrs")}catch(e){}return{isSignature:e=>t?"string"==typeof e.className&&e.className.includes("ox-signature"):a?!!(e.dataset&&e.dataset.marker&&e.dataset.marker.includes("_SIG_")):o?"signature"===e.id.toLowerCase():i?"_rc_sig"===e.id:!!n&&("string"==typeof e.className&&e.className.includes("protonmail_signature")),isQuote:e=>a?!!(e.dataset&&e.dataset.marker&&e.dataset.marker.includes("_QUOTED_")):o?"divRplyFwdMsg"===e.id||!!e.previousElementSibling&&"divRplyFwdMsg"===e.previousElementSibling.id:!!s&&"cite"===e.getAttribute("type")}},getRecipientInfo(e){try{const t="BODY"===e.tagName&&"tinymce"===e.id,a="TEXTAREA"===e.tagName&&"composebody"===e.id;if(t||a){const e=window.parent.document.getElementById("_from"),t=window.parent.document.getElementById("compose-subject"),a=window.parent.document.getElementById("_to");if(e&&t&&a){const e=TweaksManager._anonymizeEmail(a.value),t=TweaksManager._removeEmail(a.value);return Promise.resolve({address:e,fullName:t})}}}catch(e){}return Promise.resolve({address:"",fullName:""})},isClickIgnored:e=>!1,applyFix(e){const{error:t,replacementText:a,instance:o}=e;return o.inputAreaWrapper.replaceText(t.offset,t.length,a)}},TweaksManager.CUSTOM_TWEAKS={"1und1.de":{getParsingDetector:e=>({isSignature:e=>"string"==typeof e.className&&e.className.includes("signature"),isQuote:e=>"quote"===e.getAttribute("name")}),getRecipientInfo(e){try{const e=document.querySelector(".objectivation-address[title]")||window.parent.document.querySelector(".objectivation_name[title]");if(e){const t=(e.getAttribute("title")||"").replace(/"/g,""),a=TweaksManager._anonymizeEmail(t),o=TweaksManager._removeEmail(t);return Promise.resolve({address:a,fullName:o})}}catch(e){}return Promise.resolve({address:"",fullName:""})}},"atlassian.net":{isElementCompatible:e=>e.isContentEditable&&e.className.includes("ProseMirror")||TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e),toolbarSettings:e=>({isVisible:(e,t)=>e.className.includes("ProseMirror")||TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).isVisible(e,t),getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).getPosition(e,t,a)})},"canva.com":{supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("siteCannotBeSupported")},"chrome.google.com":{supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("webstoreSiteNotSupported")},"deepl.com":{isElementCompatible:e=>TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e)&&!e.className.includes("target_textarea"),applyFix(e){const t=TweaksManager.DEFAULT_TWEAKS.applyFix(e);return e.instance.inputAreaWrapper.simulateInput(e.replacementText),t}},"docs.google.com":{supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("googleDocsNotSupported","https://chrome.google.com/webstore/detail/languagetool/kjcoklfhicmkbfifghaecedbohbmofkm")},"e.mail.ru":{getRecipientInfo(e){try{const t="BODY"===e.tagName&&"tinymce"===e.id,a="TEXTAREA"===e.tagName&&e.classList.contains("composeEditor");if(t||a){const e=window.parent.document.getElementById("compose_to");if(e){const t=e.value.split(",")[0],a=TweaksManager._anonymizeEmail(t),o=TweaksManager._removeEmail(t);return Promise.resolve({address:a,fullName:o})}}}catch(e){}return Promise.resolve({address:"",fullName:""})}},"facebook.com":{toolbarSettings:e=>({isVisible:(e,t)=>t.getPaddingBox(e).width>=120,getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).getPosition(e,t,a)})},"grammarly.com":{supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("siteCannotBeSupported")},"gmx.com":{getParsingDetector:e=>({isSignature:e=>"string"==typeof e.className&&e.className.includes("signature"),isQuote:e=>"quote"===e.getAttribute("name")}),getRecipientInfo:e=>TweaksManager.CUSTOM_TWEAKS["1und1.de"].getRecipientInfo(e)},"gmx.net":{getParsingDetector:e=>({isSignature:e=>"string"==typeof e.className&&e.className.includes("signature"),isQuote:e=>"quote"===e.getAttribute("name")}),getRecipientInfo:e=>TweaksManager.CUSTOM_TWEAKS["1und1.de"].getRecipientInfo(e)},"iblogbox.com":{supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("siteCannotBeSupported")},"mytextarea.com":{toolbarSettings:e=>({isVisible:(e,t)=>TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).isVisible(e,t),getPosition(e,t,a){const o=TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).getPosition(e,t,a);return o&&o.left&&(o.left=parseInt(o.left)-25+"px"),o}})},"languagetool.org":{isElementCompatible:e=>!e.classList.contains("mceContentBody")&&TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e)},"languagetoolplus.com":{init(){document.addEventListener("lt-upgrade",()=>{Tracker.trackEvent("Action","upgrade"),new StorageController(e=>{e.checkForPaidSubscription();const{firstVisit:t}=e.getStatistics();if(t){const e=Math.floor(Date.now()-1e3*t)/1e3/60/60/24;Tracker.trackEvent("Action","upgrade_days_since_installation",String(e))}})}),document.addEventListener("lt-open-options",e=>{browser.runtime.sendMessage({command:"OPEN_OPTIONS"})});const e=document.querySelector("#lt-addon-user-token"),t=document.querySelector("#lt-addon-user-email");return e&&t&&new StorageController(a=>{if(a.isUsedCustomServer())return;const{havePremiumAccount:o}=a.getSettings();o||(a.updateSettings({havePremiumAccount:!0,username:t.value,password:"",token:e.value,knownEmail:t.value}),Tracker.trackEvent("Action","auto_login"),a.checkForPaidSubscription())}),location.href.includes("/webextension/upgrade")&&new StorageController(e=>{const{premiumClicks:t}=e.getStatistics();e.updateStatistics({premiumClicks:t+1})}),TweaksManager.DEFAULT_TWEAKS.init()},isElementCompatible:e=>!e.classList.contains("mceContentBody")&&TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e)},"linkedin.com":{toolbarSettings:e=>({isVisible:(e,t)=>TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).isVisible(e,t),getPosition(e,t,a){const o=e.nextElementSibling;if(isTextArea(e)&&o&&o.classList.contains("send-invite__count")){const i=parseInt(a.getStyle(o,"width")),n=parseInt(a.getStyle(o,"right")),s=a.getBorderBox(e);return{fixed:!1,left:Math.round(s.right-n-i-4-t.width)+"px",top:Math.round(s.bottom-4-t.height)+"px"}}return TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).getPosition(e,t,a)}})},"mail.google.com":{getParsingDetector:e=>({isSignature:e=>"string"==typeof e.className&&e.className.includes("gmail_signature"),isQuote:e=>"string"==typeof e.className&&e.className.includes("gmail_quote")}),getRecipientInfo(e){try{if("DIV"===e.tagName){const e=document.querySelector("input[name=to]");if(e){const t=TweaksManager._anonymizeEmail(e.value),a=TweaksManager._removeEmail(e.value);return Promise.resolve({address:t,fullName:a})}}}catch(e){}return Promise.resolve({address:"",fullName:""})}},"mail.rambler.ru":{getRecipientInfo(e){try{if("BODY"===e.tagName&&"tinymce"===e.id){const e=window.parent.document.querySelector("div[class*=Fields-receiverWrapper] div[class*=Fields-inputWrapper] span[class*=EmailBadge-root] span[class*=EmailBadge-text]");if(e){const t=TweaksManager._anonymizeEmail(e.textContent||""),a=TweaksManager._removeEmail(e.textContent||"");return Promise.resolve({address:t,fullName:a})}}}catch(e){}return Promise.resolve({address:"",fullName:""})}},"mail.yandex.ru":{getRecipientInfo(e){try{if("DIV"===e.tagName&&e.classList.contains("cke_wysiwyg_div")&&e.classList.contains("cke_editable")){const e=document.querySelector("div[name=to] span[bubble][data-yabble-email]");if(e){const t=TweaksManager._anonymizeEmail(e.dataset.yabbleName||""),a=TweaksManager._removeEmail(e.dataset.yabbleName||"");return Promise.resolve({address:t,fullName:a})}}}catch(e){}return Promise.resolve({address:"",fullName:""})},isClickIgnored(e){const t=e.target;return!!t&&isTextArea(t)&&"editor1"===t.id}},"mail.yahoo.com":{getParsingDetector:e=>({isSignature:e=>"string"==typeof e.className&&e.className.includes("signature"),isQuote:e=>"string"==typeof e.className&&e.className.includes("yahoo_quoted")}),getRecipientInfo(e){try{const e=document.querySelector("[data-test-id='email-pill'] [data-test-id='pill']");if(e)return Promise.resolve({address:TweaksManager._anonymizeEmail(e.getAttribute("title")||""),fullName:e.innerText.trim()})}catch(e){}return Promise.resolve({address:"",fullName:""})}},"mailbox.org":{getRecipientInfo(e){try{const t="BODY"===e.tagName&&"tinymce"===e.id,a="TEXTAREA"===e.tagName&&e.parentElement&&e.parentElement.classList.contains("editor");if(t||a){const e=window.parent.document.querySelector(".tokenfield .token span.token-label");if(e){const t=e.textContent||"",a=TweaksManager._anonymizeEmail(t),o=TweaksManager._removeEmail(t);return Promise.resolve({address:a,fullName:o})}}}catch(e){}return Promise.resolve({address:"",fullName:""})}},"my.smashdocs.net":{supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("siteCannotBeSupported")},"onedrive.live.com":{supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("msOnlineOfficeNotSupported","https://appsource.microsoft.com/de-de/product/office/WA104381727")},"overleaf.com":{supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("siteCannotBeSupported")},"outlook.live.com":{getParsingDetector:e=>({isSignature:e=>"signature"===e.id.toLowerCase(),isQuote:e=>"divRplyFwdMsg"===e.id||!!e.previousElementSibling&&"divRplyFwdMsg"===e.previousElementSibling.id}),getRecipientInfo(e){try{if("DIV"===e.tagName&&"textbox"===e.getAttribute("role")){const t=document.querySelector(".ms-BasePicker-text [aria-label]");if(t){const e=t.getAttribute("aria-label")||"",a=TweaksManager._removeEmail(e);let o=TweaksManager._anonymizeEmail(e);return o.includes("@")||(o=`${a} <${a.split(" ").join(".").toLowerCase()}@replaced.domain>`),Promise.resolve({address:o,fullName:a})}const a=e.closest("._2BzYAu1OpUlMQyUR7PQGaZ");if(a){const e=a.querySelector("span.lpc-hoverTarget[role=button][aria-haspopup=dialog] li");if(e){const t=e.textContent||"",a=TweaksManager._removeEmail(t);let o=TweaksManager._anonymizeEmail(t);return o.includes("@")||(o=`${a} <${a.split(" ").join(".").toLowerCase()}@replaced.domain>`),Promise.resolve({address:o,fullName:a})}}}}catch(e){}return Promise.resolve({address:"",fullName:""})}},"outlook.office365.com":{getParsingDetector:e=>TweaksManager.CUSTOM_TWEAKS["outlook.live.com"].getParsingDetector(e),getRecipientInfo:e=>TweaksManager.CUSTOM_TWEAKS["outlook.live.com"].getRecipientInfo(e)},"paper.dropbox.com":{toolbarSettings:e=>({isVisible:(e,t)=>!(e.offsetHeight<30&&e.classList.contains("editor-blank"))&&TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).isVisible(e,t),getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).getPosition(e,t,a)})},"reverso.net":{supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("siteCannotBeSupported")},"slack.com":{toolbarSettings:e=>!(e.parentElement&&"share-dialog-message-input"===e.parentElement.id)&&e.classList.contains("ql-editor")?{isVisible:e=>!0,getPosition(e,t,a){const o=Math.max(parseInt(a.getStyle(e,"padding-right"))+2,38),i=parseInt(a.getStyle(e,"line-height"))+parseInt(a.getStyle(e,"padding-top"))+parseInt(a.getStyle(e,"padding-bottom")),n=a.getBorderBox(e);return{fixed:!1,left:Math.round(n.right-o-t.width)+"px",top:Math.round(n.bottom-t.height+(t.height-i)/2)+"px"}}}:TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e)},"spanishdict.com":{isElementCompatible:e=>"query"!==e.id&&TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e)},"twitter.com":{toolbarSettings:e=>({isVisible(e,t){if(e.classList.contains("twttr-directmessage-input"))return!1;if(e.classList.contains("tweet-box")&&"tweet-box-dm-conversation"!==e.id){const a=64;return t.getBorderBox(e).height>=a}return TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).isVisible(e,t)},getPosition(e,t,a){if("tweet-box-dm-conversation"===e.id){const o=TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).getPosition(e,t,a);if(!o)return null;const i=20,n=5;return{fixed:!1,left:parseInt(o.left)-i-n+"px",top:o.top}}if(e.classList.contains("tweet-box")){const o=10,i=4,n=20,s=20,r=a.getBorderBox(e);return{fixed:!1,left:Math.round(r.right-o-n-t.width)+"px",top:Math.round(r.bottom-i-t.height+(t.height-s)/2)+"px"}}return TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).getPosition(e,t,a)}})},"vk.com":{toolbarSettings:e=>({isVisible(e,t){if("post_field"===e.id){const a=50;return t.getBorderBox(e).height>=a}return!e.classList.contains("page_status_input")&&TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).isVisible(e,t)},getPosition(e,t,a){const o=TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).getPosition(e,t,a);if(!o)return o;if(e.classList.contains("im_editable")||e.classList.contains("reply_field")){const t=parseInt(a.getStyle(e,"padding-right"));return Object.assign(o,{left:Math.round(parseInt(o.left)-t)+"px"})}return o}})},"upwork.com":{toolbarSettings:e=>({isVisible(e,t){const a=t.getBorderBox(e);return a.width>=160&&a.height>=34},getPosition(e,t,a){if(e.classList.contains("msg-composer-input")){const o=-112,i=-3,n=a.getBorderBox(e);return{fixed:!1,left:Math.round(n.right-o-t.width)+"px",top:Math.round(n.bottom-i-t.height)+"px"}}return TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).getPosition(e,t,a)}})},"web.de":{getParsingDetector:e=>({isSignature:e=>"string"==typeof e.className&&e.className.includes("signature"),isQuote:e=>"quote"===e.getAttribute("name")}),getRecipientInfo:e=>TweaksManager.CUSTOM_TWEAKS["1und1.de"].getRecipientInfo(e)},"liveworksheets.com":{toolbarSettings:e=>({isVisible(e,t){const a=t.getBorderBox(e);return a.width>=300&&a.height>=75},getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.toolbarSettings(e).getPosition(e,t,a)})}};